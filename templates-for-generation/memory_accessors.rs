#[inline]
#[allow(dead_code)]
fn readgsbase() -> *const u8 {
    unsafe {
        let x;
        std::arch::asm!(
            "rdgsbase {x}",
            x = out(reg) x,
            options(pure, nomem),
        );
        x
    }
}


macro_rules! memory_accessors {
    ($ty:ty, $read:ident, $write:ident) => {
        #[inline]
        #[allow(dead_code, unused_variables)]
        fn $read(memory: &[u8], addr: usize) -> Option<$ty> {
            Some(<$ty>::from_le_bytes(
                <<MEMORYGET>>
                    .try_into()
                    .ok()?,
            ))
        }

        #[inline]
        #[allow(dead_code, unused_variables)]
        fn $write(memory: &mut [u8], addr: usize, value: $ty) -> Option<()> {
            <<MEMORYGETMUT>>
                .copy_from_slice(&value.to_le_bytes());
            Some(())
        }
    };
}

memory_accessors! {u8, read_mem_u8, write_mem_u8}
memory_accessors! {u16, read_mem_u16, write_mem_u16}
memory_accessors! {u32, read_mem_u32, write_mem_u32}
memory_accessors! {u64, read_mem_u64, write_mem_u64}

memory_accessors! {i8, read_mem_i8, write_mem_i8}
memory_accessors! {i16, read_mem_i16, write_mem_i16}
memory_accessors! {i32, read_mem_i32, write_mem_i32}
memory_accessors! {i64, read_mem_i64, write_mem_i64}

memory_accessors! {f32, read_mem_f32, write_mem_f32}
memory_accessors! {f64, read_mem_f64, write_mem_f64}
